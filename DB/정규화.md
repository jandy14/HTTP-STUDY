# 정규화
데이터의 중복을 최소화하고 데이터를 구조화 하는 작업.

데이터의 삽입/삭제/갱신 시에 문제가 발생하지 않게 구조화하는 작업

정규화 단계에 따라서 7단계(1NF,2NF,3NF,BCNF,4NF,5NF,6NF)까지 있으며, 앞에 단계의 정규형를 만족하지 못하면 다음 단계 정규화를 할 수 없다.

가장 많이 사용되는 BCNF까지 알아보자.

그 전에 키에 대해 몇가지 알고 가자.

- 후보키 : 튜플(row,레코드,행)을 유일하게 식별할 수 있는 속성(컬럼,애트리뷰트)
- 기본키 : 후보키 중 선택된 키
- 대체키 : 기본키를 제외한 후보키
- 슈퍼키 : 속성들의 조합으로 만든 키 + 후보키
- 외래키 : 다른 릴레이션(테이블)에서 기본키로 사용되는 키

## 1NF (제 1 정규화)
제 1 정규형은 모든 컬럼이 `원자성`을 가져야 한다.

원자성이란 컬럼값이 여러가지 내용을 담고 있지 않다는 의미이다. 예시를 보자.

|Customer ID|First Name|Surname|Telephone Numbers|
|-|-|-|-|
|123|Robert|Ingram|555-861-2025|
|456|Jane|Wright|555-403-1659,555-776-4100|
|789|Maria|Fernandez|555-808-9633|

Telephone Numbers는 하나의 컬럼으로 여러 값을 가지고 있으므로 원자성을 가지지 못한다. 원자성을 가지기 위해서는 다음과 같이 변경해야 한다.

|Customer ID|First Name|Surname|Telephone Number|
|-|-|-|-|
|123|Robert|Ingram|555-861-2025|
|456|Jane|Wright|555-776-4100|
|456|Jane|Wright|555-403-1659|
|789|Maria|Fernandez|555-808-9633|

## 2NF (제 2 정규화)
제 2 정규화은 기본키에 대해 모든 컬럼의 `부분 함수적 종속을 제거`하는 단계다. 다른 말로 기본키에 모든 컬럼이 `완전 함수적 종속`이여야 한다.

함수적 종속이란 컬럼A에 의해 컬럼B의 값이 정해지면 이를 함수적 종속 관계라고 하며 A->B라고 표시한다.(A를 결정자, B를 종속자라고 한다.) 예를 들어 컬럼A가 학번이고 컬럼B가 학과이면 A에 의해 B의 값이 결정되므로 A->B라고 한다.

부분 함수적 종속이란 A가 단일 컬럼이 아닌 둘이상의 컬럼의 조합(슈퍼키)일 때, A의 부분만으로 B와 함수적 종속이면 부분 함수적 종속이라고 한다. 예시를 보자.

기본키 {학번,과목}
|학번|과목|학년|성적|
|-|-|-|-|
|001|A|1|85|
|001|B|1|90|
|002|A|2|92|
|003|B|3|95|

위 테이블은 다음과 같은 종속 관계를 가진다.

- {학번,과목} -> 성적
- 학번 -> 학년

기본키는 {학번,과목}이지만 학년은 학번만으로 결정되는 값이다. 학년은 기본키({학번,과목})의 부분(학번)에 종속적이다.

부분 함수 종속을 제거하기 위해서는 다음과 같이 테이블을 분리해야 한다.

|학번|과목|성적|
|-|-|-|
|001|A|85|
|001|B|90|
|002|A|92|
|003|B|95|

|학번|학년|
|-|-|
|001|1|
|002|2|
|003|3|

부분 함수적 종속은 기본키가 슈퍼키인 경우에만 일어난다.

## 3NF (제 3 정규화)
제 3 정규화는 2NF에 만족하면서 `이행적 함수 종속을 제거`하는 단계이다.

이행적 함수 종속이란 기본키와 종속 관계에 있는 컬럼이 다른 컬럼에도 종속관계가 있을 때, 이행적 함수 종속이라고 한다. 예를 들어, 기본키가 학번이고, 컬럼이 학과,등록금이 있다.

학과와 등록금은 기본키에 종속적인 관계이다. 하지만 등록금은 학과에도 종속적인 관계이다. 기호로 나타내면 다음과 같다.

- 학번 -> 학과
- 학번 -> 등록금
- 학과 -> 등록금

위와 같이 A->B,B->C인 관계(이런 관계는 자동으로 A->C가 성립한다.)가 이행적 함수 종속이며, 제 3 정규화는 이를 제거하는 과정이다. 예시를 보자

|학번|학과|등록금|
|-|-|-|
|001|컴퓨터공학|300|
|002|물리학|250|
|003|건축학|350|
|004|컴퓨터공학|300|

정규화를 하면 다음과 같다.

|학번|학과|
|-|-|
|001|컴퓨터공학|
|002|물리학|
|003|건축학|
|004|컴퓨터공학|

|학과|등록금|
|-|-|
|컴퓨터공학|300|
|물리학|250|
|건축학|350|

## BCNF (보이스-코드 정규화)
<del>뜬금없이 4가 아닌 BC가 나왔다.</del>

보이스와 코드라는 분들이 만든 정규형이며, 강화된 3 정규형, 3.5 정규형이라고도 부른다.

보이스 코드 정규화는 `결정자가 후보키가 아닌 것을 제거`하는 단계다.

예시를 보자.(강한 의문이 있지만 보고나서 얘기하자)

|학번|과목|교수|
|-|-|-|
|001|알고리즘|A|
|001|운영체제|B|
|002|알고리즘|A|
|003|네트워크|C|

위는 다음과 같은 함수 종속을 가진다고 한다.
- {학번,과목} -> 교수
- 교수 -> 과목

위의 표와 같은 상황에선 다음과 같이 정규화된다.

|학번|교수|
|-|-|
|001|A|
|001|B|
|002|A|
|003|C|

|교수|과목|
|-|-|
|A|알고리즘|
|B|운영체제|
|A|알고리즘|
|C|네트워크|

이게 정상인가...

처음에는 이 예시가 잘못되었다고 생각했으나 다른 곳에서도 약속이라도 한 듯이 이 예시뿐이다. 개인적으로 잘못됐다고 생각하는 점을 정리한다.

### **반론**

본인은 이 예시에서 이해가 안되는 점이 있다.

1. 일반적으로 교수는 과목을 결정하지 않는다. (교수는 여러 과목을 맡는다.)
1. {학번,과목}이 교수를 결정하지 않는다. (결정은 하는데 과목이 결정한다.)

1번 때문에 교수가 한 과목만 맡는다는 전제가 있긴하지만 과목도 과목당 교수가 하나다. (과목 -> 교수)

핵심은 후보키가 아닌 교수가 과목을 결정하는 관계라는 사실이다.(교수가 하나의 과목만을 맡는다는 전제하에서만)

만약 과목이 분반이 나누어져 있어 한 과목에 여러 교수가 있다면 {학번,과목}이 교수를 결정할 수도 있겠다. (교수가 과목을 결정하기고 하고)

하지만 그런 상황이면 과목이 아닌 과목코드로 명확하게 하는게 맞다고 생각한다. (정규화에서는 주제가 벗어났지만)

이에 대해 같은 의문을 가진 글이 있어 링크를 걸어둔다.

[jhin이 찾아준 링크](https://yaboong.github.io/database/2018/03/10/database-normalization-2/#하고보니-드는-의문점)

### **제대로 된 예시**
찾으면 올리겠다.

# 역 정규화
정규화를 진행하면 데이터의 중복이 줄어 들고 관리가 용이해진다. 하지만 데이터를 계속 나누다보면 join에 많은 비용이 들기도 한다. 그래서 상황에 따라 데이터를 다시 합치는 `역 정규화`를 하기도 한다. 뭐든 상황에 맞게 하는 법이다.

# 참고 자료
키의 종류
https://limkydev.tistory.com/108

슈퍼키
https://ko.wikipedia.org/wiki/%EC%8A%88%ED%8D%BC_%ED%82%A4

정규화
https://ko.wikipedia.org/wiki/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4_%EC%A0%95%EA%B7%9C%ED%99%94

정규화의 목적
https://velog.io/@wldus9503/%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%A0%95%EA%B7%9C%ED%99%94Normalization%EB%9E%80

정규화 예제<br>
https://minimax95.tistory.com/entry/%EC%A0%95%EA%B7%9C%ED%99%94Normalization-%EA%B0%9C%EB%85%90%EA%B3%BC-%EA%B8%B0%EB%B3%B8-%EA%B3%BC%EC%A0%95

https://mangkyu.tistory.com/28

제1정규형
https://ko.wikipedia.org/wiki/%EC%A0%9C1%EC%A0%95%EA%B7%9C%ED%98%95

