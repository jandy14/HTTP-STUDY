# https란
http에 보안이 추가된 프로토콜

## https의 원리를 알기 전 알아야 하는 것들
- 대칭키 암호 방식
- 비대칭키 암호 방식 (공개키 암호 방식)
- TLS (SSL)

# 대칭키 암호 방식
평문은 키를 통해 암호화하면 암호화한 키를 통해서만 복호화할 수 있는 방식을 말한다. ex) DES, AES

# 비대칭키 암호 방식 (공개키 암호 방식)
공개키와 개인키가 쌍으로써 존재하고, 평문을 공개키로 암호화하면 공개키의 쌍이 되는 개인키로만 복호화가 가능한 방식이다. ex) RSA

반대로 개인키로 평문을 암호화하면 쌍이 되는 공개키로만 복호화가 가능하다.

# TLS (SSL)
Transport Layer Security (Secure Socket Layer)

전송 계층에서 이루어지는 보안 연결 프로토콜이다. 서버와의 연결이 이루어진 뒤(3way hand-shaking)에 TLS 연결이 이루어 진다.

## CA (Certificate Authority)
인증기관은 서버가 공개키와 서버 정보를 제공하면 인증서를 발급해준다.

인증서는 인증기관의 개인키로 암호화된 파일이며, 인증기관의 공개키로 복호화가 가능하다는 것을 확인함으로써 해당 인증서가 인증기관에서 발급했다는 것을 알 수 있다.

인증서를 복호화하면 서버의 정보와 **공개키**를 얻을 수 있다.
## 전반적인 흐름
1. 서버가 자신의 공개키 개인키를 생성한다.
1. 서버가 CA에 자산의 서버에 대한 정보와 공개키를 제공하고 인증서를 발급받는다.
1. 클라이언트가 서버에 연결 시도
    1. DNS를 통해 IP 찾기
    1. TCP 연결
1. 클라이언트에서 TLS 연걸을 위해 CLIENT HELLO 전송
    - session key 생성을 위한 랜덤 값
    - 프로토콜 버전
    - 클라이언트가 지원하는 암호방식 리스트
    - session ID (기존 연결을 재 사용할 때 사용)
1. 서버에서 SERVER HELLO 전송
    - session key 생성을 위한 랜덤 값
    - 프로토콜 버전
    - 사용할 암호화 방식 (클라이언트가 보낸 방식 중 하나)
    - **인증서**
1. 클라이언트는 인증서를 복호화하여 서버의 공개키를 획득한다.
    - 인증서를 복호화할 키는 어플리케이션이 가지고 있다.
    - 예로 웹브라우저는 인증기관의 공개키들을 가지고 있으며, 공개키를 얻기위한 과정이 따로 존재하지 않는다.
1. 클라이언트는 즉석해서 대칭키를 생성해 서버의 공개키로 암호화해서 서버로 전송한다.
    - 클라이언트의 랜덤 값과 서버의 랜덤 값을 통해서 대칭키가 만들어진다.
1. 서버는 자신의 개인키로 클라이언트가 보낸 내용을 복호화해 대칭키를 획득한다.
1. 안전하게 공유한 대칭키를 통해 내용을 암호화해서 전달하고 받는다.
1. session이 종료되면 대칭키는 폐기한다.

## 의문
### 왜 대칭키로 내용을 주고 받는가
서로 공개키로 정보를 전달받으면 안전하다. 하지만 TLS는 대칭키를 통해서 정보를 전달받는다. 왜 그럴까?

공개키 방식은 대칭키 방식에 비해 매우 느리다는 단점이 있기 때문이다.

처음부터 대칭키를 쓰지 않은 것은 대칭키는 키 생성도 암호화 복호화도 빠르지만 서버와 클라이언트가 키를 안전하게 공유할 방식이 없기 때문이다.

그래서 나온 결론이 대칭키만 공개키방식으로 전달하고 그 이후에는 대칭키로 암호화하는 것이다. 이로 인해 대칭키를 안전하게 전달받을 수 있고, 대칭키로 내용을 전달해 빠른 통신이 가능하게 된다.

### 만약 인증서가 인증기관 리스트에 없다면 어떻게 되는 것일까? 일반적인 http로 작동하는 것일까?
모르겠다.

# 다시 https란
http이전에 tls를 통해서 보안 연결을 만든 다음 http request를 대칭키로 암호화하여 전송하면, 서버에서 대칭키를 통해 복호화하여 받는 프로토콜

즉, TLS + http

# 참고 자료
ssl에 대하여
https://opentutorials.org/course/228/4894

ssl 통신 과정
https://wayhome25.github.io/cs/2018/03/11/ssl-https/

ssl 패킷 내용
http://blog.naver.com/PostView.nhn?blogId=seri0528&logNo=20188008125

ssl 랜덤 값의 의미
https://edu.goorm.io/learn/lecture/12973/%EC%83%9D%ED%99%9C%EC%BD%94%EB%94%A9-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EA%B0%9C%EB%85%90-%EC%9E%A1%EA%B8%B0-%EB%8F%84%EB%A9%94%EC%9D%B8-%EB%84%A4%EC%9E%84%EC%84%9C%EB%B2%84-https/lesson/562732/ssl-%ED%86%B5%EC%8B%A0-%EA%B3%BC%EC%A0%95
